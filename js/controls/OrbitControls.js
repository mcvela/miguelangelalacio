THREE.OrbitControls=function(A,B){this.object=A;this.domElement=(B!==undefined)?B:document;this.enabled=true;this.target=new THREE.Vector3();this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var x=this;var c=0.000001;var q=new THREE.Vector2();var n=new THREE.Vector2();var y=new THREE.Vector2();var d=new THREE.Vector2();var o=new THREE.Vector2();var k=new THREE.Vector2();var E=new THREE.Vector3();var z=new THREE.Vector3();var p=new THREE.Vector2();var b=new THREE.Vector2();var w=new THREE.Vector2();var v=0;var h=0;var s=1;var j=new THREE.Vector3();var e=new THREE.Vector3();var f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var K=f.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var J=new THREE.Quaternion().setFromUnitVectors(A.up,new THREE.Vector3(0,1,0));var m=J.clone().inverse();var G={type:"change"};var C={type:"start"};var r={type:"end"};this.rotateLeft=function(L){if(L===undefined){L=g()}h-=L};this.rotateUp=function(L){if(L===undefined){L=g()}v-=L};this.panLeft=function(M){var L=this.object.matrix.elements;E.set(L[0],L[1],L[2]);E.multiplyScalar(-M);j.add(E)};this.panUp=function(M){var L=this.object.matrix.elements;E.set(L[4],L[5],L[6]);E.multiplyScalar(M);j.add(E)};this.pan=function(N,M){var O=x.domElement===document?x.domElement.body:x.domElement;if(x.object.fov!==undefined){var L=x.object.position;var Q=L.clone().sub(x.target);var P=Q.length();P*=Math.tan((x.object.fov/2)*Math.PI/180);x.panLeft(2*N*P/O.clientHeight);x.panUp(2*M*P/O.clientHeight)}else{if(x.object.top!==undefined){x.panLeft(N*(x.object.right-x.object.left)/O.clientWidth);x.panUp(M*(x.object.top-x.object.bottom)/O.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}}};this.dollyIn=function(L){if(L===undefined){L=t()}s/=L};this.dollyOut=function(L){if(L===undefined){L=t()}s*=L};this.update=function(){var M=this.object.position;z.copy(M).sub(this.target);z.applyQuaternion(J);var N=Math.atan2(z.x,z.z);var O=Math.atan2(Math.sqrt(z.x*z.x+z.z*z.z),z.y);if(this.autoRotate){this.rotateLeft(g())}N+=h;O+=v;O=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,O));O=Math.max(c,Math.min(Math.PI-c,O));var L=z.length()*s;L=Math.max(this.minDistance,Math.min(this.maxDistance,L));this.target.add(j);z.x=L*Math.sin(O)*Math.sin(N);z.y=L*Math.cos(O);z.z=L*Math.sin(O)*Math.cos(N);z.applyQuaternion(m);M.copy(this.target).add(z);this.object.lookAt(this.target);h=0;v=0;s=1;j.set(0,0,0);if(e.distanceToSquared(this.object.position)>c){this.dispatchEvent(G);e.copy(this.object.position)}};this.reset=function(){K=f.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function g(){return 2*Math.PI/60/60*x.autoRotateSpeed}function t(){return Math.pow(0.95,x.zoomSpeed)}function F(L){if(x.enabled===false){return}L.preventDefault();if(L.button===0){if(x.noRotate===true){return}K=f.ROTATE;q.set(L.clientX,L.clientY)}else{if(L.button===1){if(x.noZoom===true){return}K=f.DOLLY;p.set(L.clientX,L.clientY)}else{if(L.button===2){if(x.noPan===true){return}K=f.PAN;d.set(L.clientX,L.clientY)}}}x.domElement.addEventListener("mousemove",a,false);x.domElement.addEventListener("mouseup",I,false);x.dispatchEvent(C)}function a(M){if(x.enabled===false){return}M.preventDefault();var L=x.domElement===document?x.domElement.body:x.domElement;if(K===f.ROTATE){if(x.noRotate===true){return}n.set(M.clientX,M.clientY);y.subVectors(n,q);x.rotateLeft(2*Math.PI*y.x/L.clientWidth*x.rotateSpeed);x.rotateUp(2*Math.PI*y.y/L.clientHeight*x.rotateSpeed);q.copy(n)}else{if(K===f.DOLLY){if(x.noZoom===true){return}b.set(M.clientX,M.clientY);w.subVectors(b,p);if(w.y>0){x.dollyIn()}else{x.dollyOut()}p.copy(b)}else{if(K===f.PAN){if(x.noPan===true){return}o.set(M.clientX,M.clientY);k.subVectors(o,d);x.pan(k.x,k.y);d.copy(o)}}}x.update()}function I(){if(x.enabled===false){return}x.domElement.removeEventListener("mousemove",a,false);x.domElement.removeEventListener("mouseup",I,false);x.dispatchEvent(r);K=f.NONE}function D(L){if(x.enabled===false||x.noZoom===true){return}L.preventDefault();L.stopPropagation();var M=0;if(L.wheelDelta!==undefined){M=L.wheelDelta}else{if(L.detail!==undefined){M=-L.detail}}if(M>0){x.dollyOut()}else{x.dollyIn()}x.update();x.dispatchEvent(C);x.dispatchEvent(r)}function i(L){if(x.enabled===false||x.noKeys===true||x.noPan===true){return}switch(L.keyCode){case x.keys.UP:x.pan(0,x.keyPanSpeed);x.update();break;case x.keys.BOTTOM:x.pan(0,-x.keyPanSpeed);x.update();break;case x.keys.LEFT:x.pan(x.keyPanSpeed,0);x.update();break;case x.keys.RIGHT:x.pan(-x.keyPanSpeed,0);x.update();break}}function H(N){if(x.enabled===false){return}switch(N.touches.length){case 1:if(x.noRotate===true){return}K=f.TOUCH_ROTATE;q.set(N.touches[0].pageX,N.touches[0].pageY);break;case 2:if(x.noZoom===true){return}K=f.TOUCH_DOLLY;var M=N.touches[0].pageX-N.touches[1].pageX;var L=N.touches[0].pageY-N.touches[1].pageY;var O=Math.sqrt(M*M+L*L);p.set(0,O);break;case 3:if(x.noPan===true){return}K=f.TOUCH_PAN;d.set(N.touches[0].pageX,N.touches[0].pageY);break;default:K=f.NONE}x.dispatchEvent(C)}function l(O){if(x.enabled===false){return}O.preventDefault();O.stopPropagation();var N=x.domElement===document?x.domElement.body:x.domElement;switch(O.touches.length){case 1:if(x.noRotate===true){return}if(K!==f.TOUCH_ROTATE){return}n.set(O.touches[0].pageX,O.touches[0].pageY);y.subVectors(n,q);x.rotateLeft(2*Math.PI*y.x/N.clientWidth*x.rotateSpeed);x.rotateUp(2*Math.PI*y.y/N.clientHeight*x.rotateSpeed);q.copy(n);x.update();break;case 2:if(x.noZoom===true){return}if(K!==f.TOUCH_DOLLY){return}var M=O.touches[0].pageX-O.touches[1].pageX;var L=O.touches[0].pageY-O.touches[1].pageY;var P=Math.sqrt(M*M+L*L);b.set(0,P);w.subVectors(b,p);if(w.y>0){x.dollyOut()}else{x.dollyIn()}p.copy(b);x.update();break;case 3:if(x.noPan===true){return}if(K!==f.TOUCH_PAN){return}o.set(O.touches[0].pageX,O.touches[0].pageY);k.subVectors(o,d);x.pan(k.x,k.y);d.copy(o);x.update();break;default:K=f.NONE}}function u(){if(x.enabled===false){return}x.dispatchEvent(r);K=f.NONE}this.domElement.addEventListener("contextmenu",function(L){L.preventDefault()},false);this.domElement.addEventListener("mousedown",F,false);this.domElement.addEventListener("mousewheel",D,false);this.domElement.addEventListener("DOMMouseScroll",D,false);this.domElement.addEventListener("touchstart",H,false);this.domElement.addEventListener("touchend",u,false);this.domElement.addEventListener("touchmove",l,false);window.addEventListener("keydown",i,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);